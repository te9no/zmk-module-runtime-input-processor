syntax = "proto3";

package cormoran.rip;

// Runtime Input Processor Messages
message InputProcessorInfo {
    uint32 id               = 1;  // Processor ID (index in array)
    string name             = 2;  // Short name (max 8 chars for BLE)
    uint32 scale_multiplier = 3;  // Scaling multiplier
    uint32 scale_divisor =
        4;  // Scaling divisor (multiply by scale_multiplier/scale_divisor)
    int32 rotation_degrees = 5;  // Rotation angle in degrees
    // Auto-mouse layer settings
    bool temp_layer_enabled = 6;  // Whether temp-layer is enabled
    uint32 temp_layer_layer = 7;  // Target layer ID for temp-layer
    uint32 temp_layer_activation_delay_ms = 8;  // Delay before activating (ms)
    uint32 temp_layer_deactivation_delay_ms = 9;  // Delay before deactivating (ms)
    // Active layers bitmask (0 = all layers)
    uint32 active_layers = 10;  // Bitmask of layers where processor is active
}

message ListInputProcessorsRequest {
    // Empty - requests list of all input processors
}

message ListInputProcessorsResponse {
    // Empty - use notification to report processors
}

message GetInputProcessorRequest {
    uint32 id = 1;  // ID of the input processor
}

message GetInputProcessorResponse {
    InputProcessorInfo processor = 1;
}

message LayerInfo {
    uint32 index = 1;  // Layer index
    string name = 2;   // Layer name
}

message GetLayerInfoRequest {
    // Empty - requests list of all layers
}

message GetLayerInfoResponse {
    repeated LayerInfo layers = 1;  // List of layers with their names
}

message SetScaleMultiplierRequest {
    uint32 id    = 1;  // ID of the input processor to update
    uint32 value = 2;  // New scaling multiplier
}

message SetScaleDivisorRequest {
    uint32 id    = 1;  // ID of the input processor to update
    uint32 value = 2;  // New scaling divisor
}

message SetRotationRequest {
    uint32 id   = 1;  // ID of the input processor to update
    int32 value = 2;  // New rotation angle in degrees
}

message ResetInputProcessorRequest {
    uint32 id = 1;  // ID of the input processor to reset
}

message SetTempLayerEnabledRequest {
    uint32 id    = 1;  // ID of the input processor to update
    bool enabled = 2;  // Whether temp-layer is enabled
}

message SetTempLayerLayerRequest {
    uint32 id    = 1;  // ID of the input processor to update
    uint32 layer = 2;  // Target layer ID for temp-layer
}

message SetTempLayerActivationDelayRequest {
    uint32 id                  = 1;  // ID of the input processor to update
    uint32 activation_delay_ms = 2;  // Delay before activating (ms)
}

message SetTempLayerDeactivationDelayRequest {
    uint32 id                    = 1;  // ID of the input processor to update
    uint32 deactivation_delay_ms = 2;  // Delay before deactivating (ms)
}

message SetActiveLayersRequest {
    uint32 id     = 1;  // ID of the input processor to update
    uint32 layers = 2;  // Bitmask of layers where processor is active (0 = all)
}

message SetScaleMultiplierResponse {
    // Empty - use notification to report changes
}

message SetScaleDivisorResponse {
    // Empty - use notification to report changes
}

message SetRotationResponse {
    // Empty - use notification to report changes
}

message ResetInputProcessorResponse {
    // Empty - use notification to report changes
}

message SetTempLayerEnabledResponse {
    // Empty - use notification to report changes
}

message SetTempLayerLayerResponse {
    // Empty - use notification to report changes
}

message SetTempLayerActivationDelayResponse {
    // Empty - use notification to report changes
}

message SetTempLayerDeactivationDelayResponse {
    // Empty - use notification to report changes
}

message SetActiveLayersResponse {
    // Empty - use notification to report changes
}

message Request {
    oneof request_type {
        ListInputProcessorsRequest list_input_processors = 1;
        GetInputProcessorRequest get_input_processor     = 2;
        SetScaleMultiplierRequest set_scale_multiplier   = 3;
        SetScaleDivisorRequest set_scale_divisor         = 4;
        SetRotationRequest set_rotation                  = 5;
        ResetInputProcessorRequest reset_input_processor = 6;
        SetTempLayerEnabledRequest set_temp_layer_enabled = 7;
        SetTempLayerLayerRequest set_temp_layer_layer = 8;
        SetTempLayerActivationDelayRequest set_temp_layer_activation_delay = 9;
        SetTempLayerDeactivationDelayRequest set_temp_layer_deactivation_delay = 10;
        SetActiveLayersRequest set_active_layers = 11;
        GetLayerInfoRequest get_layer_info = 12;
    }
}

message ErrorResponse {
    string message = 1;
}

message Response {
    oneof response_type {
        ErrorResponse error                               = 1;
        ListInputProcessorsResponse list_input_processors = 2;
        GetInputProcessorResponse get_input_processor     = 3;
        SetScaleMultiplierResponse set_scale_multiplier   = 4;
        SetScaleDivisorResponse set_scale_divisor         = 5;
        SetRotationResponse set_rotation                  = 6;
        ResetInputProcessorResponse reset_input_processor = 7;
        SetTempLayerEnabledResponse set_temp_layer_enabled = 8;
        SetTempLayerLayerResponse set_temp_layer_layer = 9;
        SetTempLayerActivationDelayResponse set_temp_layer_activation_delay = 10;
        SetTempLayerDeactivationDelayResponse set_temp_layer_deactivation_delay = 11;
        SetActiveLayersResponse set_active_layers = 12;
        GetLayerInfoResponse get_layer_info = 13;
    }
}

// Notifications
message InputProcessorChangedNotification {
    InputProcessorInfo processor = 1;
}

message Notification {
    oneof notification_type {
        InputProcessorChangedNotification input_processor_changed = 1;
    }
}
